<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.242">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alejandro Morales Sierra">
<meta name="dcterms.date" content="2022-11-10">

<title>Virtual Plant Laboratory - Relational queries</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Relational queries</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Virtual Plant Laboratory</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">Julia basics</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../julia_basics/index.html" class="sidebar-item-text sidebar-link">Julia basics for VPL</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">User Manual</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">Graphs</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../manual/Graphs/index.html" class="sidebar-item-text sidebar-link">Dynamic graph creation and manipulation</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">Visualization</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../manual/Visualization/index.html" class="sidebar-item-text sidebar-link">Backends for visualization</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">Tutorials - Beginner</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/algae/index.html" class="sidebar-item-text sidebar-link">Algae growth</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/snowflakes/index.html" class="sidebar-item-text sidebar-link">The Koch snowflake</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/binary_tree/index.html" class="sidebar-item-text sidebar-link">Binary tree</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/random_binary_forest/index.html" class="sidebar-item-text sidebar-link">Forest of binary trees</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Tutorials - Advanced</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/relational_queries/index.html" class="sidebar-item-text sidebar-link active">Relational queries</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">API</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../api/Core.html" class="sidebar-item-text sidebar-link">Module Core</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../api/Geometry.html" class="sidebar-item-text sidebar-link">Module Geometry</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../api/Render.html" class="sidebar-item-text sidebar-link">Module Render</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">Sky</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Sky/index.html" class="sidebar-item-text sidebar-link">Sky solar radiation</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">Ecophys</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Ecophys/index.html" class="sidebar-item-text sidebar-link">Ecophysiological modules</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false">GCIM</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../GCIM/index.html" class="sidebar-item-text sidebar-link">Generic crop interactions model</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Relational queries</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alejandro Morales Sierra </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 10, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>In this example we illustrate how to test relationships among nodes inside queries. Relational queries allow to establish relationships between nodes in the graph, which generally requires a intimiate knowledge of the graph. For this reason, relational queries are inheretly complex as graphs can become complex and there may be solutions that do not require relational queries in many instances. Nevertheless, they are integral part of VPL and can sometimes be useful. As they can be hard to grasp, this tutorial will illustrate with a relatively simple graph a series of relational queries with increasing complexity with the aim that users will get a better understanding of relational queries. For this purpose, an abstract graph with several branching levels will be used, so that we can focus on the relations among the nodes without being distracted by case-specific details.</p>
<p>The graph will be composed of two types of nodes: the inner nodes (<code>A</code> and <code>C</code>) and the leaf nodes (<code>B</code>). Each leaf node will be identified uniquely with an index and the objective is to write queries that can identify a specific subset of the leaf nodes, without using the data stored in the nodes themselves. That is, the queries should select the right nodes based on their relationships to the rest of nodes in the graph. Note that <code>C</code> nodes contain a single value that may be positive or negative, whereas <code>A</code> nodes contain no data.</p>
<p>As usual, we start with defining the types of nodes in the graph</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">VPL</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> Queries</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="im">using</span> <span class="bu">VPL</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> A <span class="op">&lt;:</span><span class="dt"> Node </span><span class="kw">end</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> C <span class="op">&lt;:</span><span class="dt"> Node</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        val<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> B <span class="op">&lt;:</span><span class="dt"> Node</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        ID<span class="op">::</span><span class="dt">Int</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">.Queries </span>as Q</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We generate the graph directly, rather than with rewriting rules. The graph has a motif that is repeated three times (with a small variation), so we can create the graph in a piecewise manner. Note how we can use the function <code>sum</code> to add nodes to the graph (i.e.&nbsp;<code>sum(A() for i in 1:3)</code> is equivalent to <code>A() + A() + A()</code>)</p>
<!-- TODO: Need to use a labelling function in order for this to work properly -->
<!-- TODO: Comment on why the id may not be what we want to print because it is an internal id -->
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">motif</span>(n, i <span class="op">=</span> <span class="fl">0</span>) <span class="op">=</span> Q.<span class="fu">A</span>() <span class="op">+</span> (Q.<span class="fu">C</span>(<span class="fl">45.0</span>) <span class="op">+</span> Q.<span class="fu">A</span>() <span class="op">+</span> (Q.<span class="fu">C</span>(<span class="fl">45.0</span>) <span class="op">+</span>  Q.<span class="fu">A</span>() <span class="op">+</span> Q.<span class="fu">B</span>(i <span class="op">+</span> <span class="fl">1</span>), </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                                           Q.<span class="fu">C</span>(<span class="op">-</span><span class="fl">45.0</span>) <span class="op">+</span> Q.<span class="fu">A</span>() <span class="op">+</span> Q.<span class="fu">B</span>(i <span class="op">+</span> <span class="fl">2</span>), </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                                                       Q.<span class="fu">A</span>() <span class="op">+</span> Q.<span class="fu">B</span>(i <span class="op">+</span> <span class="fl">3</span>)), </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                         Q.<span class="fu">C</span>(<span class="op">-</span> <span class="fl">45.0</span>) <span class="op">+</span> <span class="fu">sum</span>(Q.<span class="fu">A</span>() <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n) <span class="op">+</span> Q.<span class="fu">B</span>(i <span class="op">+</span> <span class="fl">4</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>axiom <span class="op">=</span>  <span class="fu">motif</span>(<span class="fl">3</span>, <span class="fl">0</span>) <span class="op">+</span> <span class="fu">motif</span>(<span class="fl">2</span>, <span class="fl">4</span>) <span class="op">+</span> <span class="fu">motif</span>(<span class="fl">1</span>, <span class="fl">8</span>) <span class="op">+</span> Q.<span class="fu">A</span>() <span class="op">+</span> Q.<span class="fu">A</span>() <span class="op">+</span> Q.<span class="fu">B</span>(<span class="fl">13</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> <span class="fu">Graph</span>(axiom <span class="op">=</span> axiom);</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">draw</span>(graph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="3">
<p><img src="index_files\figure-html/cell-3-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>By default, VPL will use as node label the type of node and the internal ID generated by VPL itself. This ID is useful if we want to extract a particular node from the graph, but it is not controlled by the user. However, the user can specialized the function <code>node_label()</code> to specify exactly how to label the nodes of a particular type. In this case, we want to just print <code>A</code> or <code>C</code> for nodes of type <code>A</code> and <code>C</code>, whereas for nodes of type <code>B</code> we want to use the <code>ID</code> field that was stored inside the node during the graph generation.</p>
<div class="cell" data-execution_count="3">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>VPL.<span class="fu">node_label</span>(n<span class="op">::</span><span class="dt">Q.B</span>, id) <span class="op">=</span> <span class="st">"B-</span><span class="sc">$</span>(n.ID)<span class="st">"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>VPL.<span class="fu">node_label</span>(n<span class="op">::</span><span class="dt">Q.A</span>, id) <span class="op">=</span> <span class="st">"A"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>VPL.<span class="fu">node_label</span>(n<span class="op">::</span><span class="dt">Q.C</span>, id) <span class="op">=</span> <span class="st">"C"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">draw</span>(graph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="4">
<p><img src="index_files\figure-html/cell-4-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>To clarify, the <code>id</code> argument of the function <code>node_label()</code> refers to the internal id generated by VPL (used by the default method for <code>node_label()</code>, whereas the the first argument is the data stored inside a node (in the case of <code>B</code> nodes, there is a field called <code>ID</code> that will not be modified by VPL as that is user-provided data).</p>
<p>The goal of this exercise is then to write queries that retrieve specific <code>B</code> nodes (without using the data stored in the node in the query, that is, we have to identify nodes based on their topological connections to other nodes).</p>
<section id="all-nodes-of-type-b" class="level2">
<h2 class="anchored" data-anchor-id="all-nodes-of-type-b">All nodes of type <code>B</code></h2>
<p>First, we create the query object. In this case, there is no special condition as we want to retrieve all the nodes of type <code>B</code></p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Q1 <span class="op">=</span> <span class="fu">Query</span>(Q.B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="5">
<pre><code>Query object for nodes of type Main.Queries.B</code></pre>
</div>
</div>
<p>Applying the query to the graph returns an array with all the <code>B</code> nodes</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>A1 <span class="op">=</span> <span class="fu">apply</span>(graph, Q1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="6">
<pre><code>13-element Vector{Main.Queries.B}:
 Main.Queries.B(7)
 Main.Queries.B(8)
 Main.Queries.B(3)
 Main.Queries.B(10)
 Main.Queries.B(5)
 Main.Queries.B(6)
 Main.Queries.B(2)
 Main.Queries.B(12)
 Main.Queries.B(1)
 Main.Queries.B(11)
 Main.Queries.B(13)
 Main.Queries.B(9)
 Main.Queries.B(4)</code></pre>
</div>
</div>
<p>For the remainder of this tutorial, the code will be hidden by default to allow users to try on their own.</p>
</section>
<section id="node-containing-value-13" class="level2">
<h2 class="anchored" data-anchor-id="node-containing-value-13">Node containing value 13</h2>
<p>Since the <code>B</code> node 13 is the leaf node of the main branch of the graph (e.g.&nbsp;this could be the apical meristem of the main stem of a plant), there are no rotations between the root node of the graph and this node. Therefore, the only condition require to single out this node is that it has no ancestor node of type <code>C</code>.</p>
<p>Checking whether a node has an ancestor that meets a certain condition can be achieved with the function <code>hasAncestor()</code>. Similarly to the condition of the <code>Query</code> object, the <code>hasAncestor()</code> function also has a condition, in this case applied to the parent node of the node being tested, and moving upwards in the graph recursively (until reaching the root node). Note that, in order to access the object stored inside the node, we need to use the <code>data()</code> function, and then we can test if that object is of type <code>C</code>. The <code>B</code> node 13 is the only node for which <code>hasAncestor()</code> should return <code>false</code>:</p>
<!-- FIXME: Describe better what the hasAncestor function takes and returns -->
<div class="cell" data-execution_count="6">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Q2_fun</span>(n)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    check, steps <span class="op">=</span> <span class="fu">hasAncestor</span>(n, condition <span class="op">=</span> x <span class="op">-&gt;</span> <span class="fu">data</span>(x) isa Q.C)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    !check</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="7">
<pre><code>Q2_fun (generic function with 1 method)</code></pre>
</div>
</div>
<p>As before, we just need to apply the <code>Query</code> object to the graph:</p>
<div class="cell" data-execution_count="7">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Q2 <span class="op">=</span> <span class="fu">Query</span>(Q.B, condition <span class="op">=</span> Q2_fun)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>A2 <span class="op">=</span> <span class="fu">apply</span>(graph, Q2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="8">
<pre><code>1-element Vector{Main.Queries.B}:
 Main.Queries.B(13)</code></pre>
</div>
</div>
</section>
<section id="nodes-containing-values-1-2-and-3" class="level2">
<h2 class="anchored" data-anchor-id="nodes-containing-values-1-2-and-3">Nodes containing values 1, 2 and 3</h2>
<p>These three nodes belong to one of the branch motifs repeated through the graph. Thus, we need to identify the specific motif they belong to and chose all the <code>B</code> nodes inside that motif. The motif is defined by an <code>A</code> node that has a <code>C</code> child with a negative <code>val</code> and parent node <code>C</code> with positive <code>val</code>. This <code>A</code> node should then be 2 nodes away from the root node to separate it from upper repetitions of the motif. Therefore, we need to test for two conditions, first find those nodes inside a branch motif, then retrieve the root of the branch motif (i.e., the <code>A</code> node described in the above) and then check the distance of that node from the root:</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">branch_motif</span>(p)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data</span>(p) isa Q.A <span class="op">&amp;&amp;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hasDescendent</span>(p, condition <span class="op">=</span> x <span class="op">-&gt;</span> <span class="fu">data</span>(x) isa Q.C <span class="op">&amp;&amp;</span> <span class="fu">data</span>(x).val <span class="op">&lt;</span> <span class="fl">0.0</span>) <span class="op">&amp;&amp;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hasAncestor</span>(p, condition <span class="op">=</span> x <span class="op">-&gt;</span> <span class="fu">data</span>(x) isa Q.C <span class="op">&amp;&amp;</span> <span class="fu">data</span>(x).val <span class="op">&gt;</span> <span class="fl">0.0</span>)[<span class="fl">1</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Q3_fun</span>(n, nsteps)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Condition 1</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    check, steps <span class="op">=</span> <span class="fu">hasAncestor</span>(n, condition <span class="op">=</span> branch_motif)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    !check <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">false</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Condition 2</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">parent</span>(n, nsteps <span class="op">=</span> steps)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    check, steps <span class="op">=</span> <span class="fu">hasAncestor</span>(p, condition <span class="op">=</span> isRoot)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    steps <span class="op">!=</span> nsteps <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">false</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cn">true</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="9">
<pre><code>Q3_fun (generic function with 1 method)</code></pre>
</div>
</div>
<p>And applying the query to the object results in the required nodes:</p>
<div class="cell" data-execution_count="9">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>Q3 <span class="op">=</span> <span class="fu">Query</span>(Q.B, condition <span class="op">=</span> n <span class="op">-&gt;</span> <span class="fu">Q3_fun</span>(n, <span class="fl">2</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>A3 <span class="op">=</span> <span class="fu">apply</span>(graph, Q3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="10">
<pre><code>3-element Vector{Main.Queries.B}:
 Main.Queries.B(3)
 Main.Queries.B(2)
 Main.Queries.B(1)</code></pre>
</div>
</div>
</section>
<section id="node-containing-value-4" class="level2">
<h2 class="anchored" data-anchor-id="node-containing-value-4">Node containing value 4</h2>
<p>The node <code>B</code> with value 4 can be singled-out because there is no branching point between the root node and this node. This means that no ancestor node should have more than one children node except the root node. Remember that <code>hasAncestor()</code> returns two values, but we are only interested in the first value. You do not need to assign the returned object from a Julia function, you can just index directly the element to be selected from the returned tuple:</p>
<div class="cell" data-execution_count="10">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Q4_fun</span>(n)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    !<span class="fu">hasAncestor</span>(n, condition <span class="op">=</span> x <span class="op">-&gt;</span> !<span class="fu">isRoot</span>(x) <span class="op">&amp;&amp;</span> <span class="fu">length</span>(<span class="fu">children</span>(x)) <span class="op">&gt;</span> <span class="fl">1</span>)[<span class="fl">1</span>]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="11">
<pre><code>Q4_fun (generic function with 1 method)</code></pre>
</div>
</div>
<p>And applying the query to the object results in the required node:</p>
<div class="cell" data-execution_count="11">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>Q4 <span class="op">=</span> <span class="fu">Query</span>(Q.B, condition <span class="op">=</span> Q4_fun)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>A4 <span class="op">=</span> <span class="fu">apply</span>(graph, Q4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="12">
<pre><code>1-element Vector{Main.Queries.B}:
 Main.Queries.B(4)</code></pre>
</div>
</div>
</section>
<section id="node-containing-value-3" class="level2">
<h2 class="anchored" data-anchor-id="node-containing-value-3">Node containing value 3</h2>
<p>This node is the only <code>B</code> node that is four steps from the root node, which we can retrieve from the second argument returned by <code>hasAncestor()</code>:</p>
<div class="cell" data-execution_count="12">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Q5_fun</span>(n)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    check, steps <span class="op">=</span> <span class="fu">hasAncestor</span>(n, condition <span class="op">=</span> isRoot)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    steps <span class="op">==</span> <span class="fl">4</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>Q5 <span class="op">=</span> <span class="fu">Query</span>(Q.B, condition <span class="op">=</span> Q5_fun)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>A5 <span class="op">=</span> <span class="fu">apply</span>(graph, Q5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="13">
<pre><code>1-element Vector{Main.Queries.B}:
 Main.Queries.B(3)</code></pre>
</div>
</div>
</section>
<section id="node-containing-value-7" class="level2">
<h2 class="anchored" data-anchor-id="node-containing-value-7">Node containing value 7</h2>
<p>Node <code>B</code> 7 belongs to the second lateral branch motif and the second parent node is of type <code>A</code>. Note that we can reuse the <code>Q3_fun</code> from before in the condition required for this node:</p>
<div class="cell" data-execution_count="13">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Q6_fun</span>(n, nA)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    check <span class="op">=</span> <span class="fu">Q3_fun</span>(n, nA)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    !check <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">false</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> <span class="fu">parent</span>(n, nsteps <span class="op">=</span> <span class="fl">2</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data</span>(p2) isa Q.A</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>Q6 <span class="op">=</span> <span class="fu">Query</span>(Q.B, condition <span class="op">=</span> n <span class="op">-&gt;</span> <span class="fu">Q6_fun</span>(n, <span class="fl">3</span>))</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>A6 <span class="op">=</span> <span class="fu">apply</span>(graph, Q6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="14">
<pre><code>1-element Vector{Main.Queries.B}:
 Main.Queries.B(7)</code></pre>
</div>
</div>
</section>
<section id="nodes-containing-values-11-and-13" class="level2">
<h2 class="anchored" data-anchor-id="nodes-containing-values-11-and-13">Nodes containing values 11 and 13</h2>
<p>The <code>B</code> nodes 11 and 13 actually have different relationships to the rest of the graph, so we just need to define two different condition functions and combine them. The condition for the <code>B</code> node 11 is similar to the <code>B</code> node 7, whereas the condition for node 13 was already constructed before, so we just need to combined them with an OR operator:</p>
<div class="cell" data-execution_count="14">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Q7 <span class="op">=</span> <span class="fu">Query</span>(Q.B, condition <span class="op">=</span> n <span class="op">-&gt;</span> <span class="fu">Q6_fun</span>(n, <span class="fl">4</span>) <span class="op">||</span> <span class="fu">Q2_fun</span>(n))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>A7 <span class="op">=</span> <span class="fu">apply</span>(graph, Q7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="15">
<pre><code>2-element Vector{Main.Queries.B}:
 Main.Queries.B(11)
 Main.Queries.B(13)</code></pre>
</div>
</div>
</section>
<section id="nodes-containing-values-1-5-and-9" class="level2">
<h2 class="anchored" data-anchor-id="nodes-containing-values-1-5-and-9">Nodes containing values 1, 5 and 9</h2>
<p>These nodes play the same role in the three lateral branch motifs. They are the only <code>B</code> nodes preceded by the sequence A C+ A. We just need to check the sequence og types of objects for the the first three parents of each <code>B</code> node:</p>
<div class="cell" data-execution_count="15">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Q8_fun</span>(n)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> <span class="fu">parent</span>(n)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> <span class="fu">parent</span>(n, nsteps <span class="op">=</span> <span class="fl">2</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    p3 <span class="op">=</span> <span class="fu">parent</span>(n, nsteps <span class="op">=</span> <span class="fl">3</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data</span>(p1) isa Q.A <span class="op">&amp;&amp;</span> <span class="fu">data</span>(p2) isa Q.C <span class="op">&amp;&amp;</span> <span class="fu">data</span>(p2).val <span class="op">&gt;</span> <span class="fl">0.0</span> <span class="op">&amp;&amp;</span> <span class="fu">data</span>(p3) isa Q.A</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>Q8 <span class="op">=</span> <span class="fu">Query</span>(Q.B, condition <span class="op">=</span> Q8_fun)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>A8 <span class="op">=</span> <span class="fu">apply</span>(graph, Q8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="16">
<pre><code>3-element Vector{Main.Queries.B}:
 Main.Queries.B(5)
 Main.Queries.B(1)
 Main.Queries.B(9)</code></pre>
</div>
</div>
</section>
<section id="nodes-contaning-values-2-6-and-10" class="level2">
<h2 class="anchored" data-anchor-id="nodes-contaning-values-2-6-and-10">Nodes contaning values 2, 6 and 10</h2>
<p>This exercise is similar to the previous one, but the C node has a negative <code>val</code>. The problem is that node 12 would also match the pattern A C- A. We can differentiate between this node and the rest by checking for a fourth ancestor node of class <code>C</code>:</p>
<div class="cell" data-execution_count="16">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Q9_fun</span>(n)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> <span class="fu">parent</span>(n)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> <span class="fu">parent</span>(n, nsteps <span class="op">=</span> <span class="fl">2</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    p3 <span class="op">=</span> <span class="fu">parent</span>(n, nsteps <span class="op">=</span> <span class="fl">3</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    p4 <span class="op">=</span> <span class="fu">parent</span>(n, nsteps <span class="op">=</span> <span class="fl">4</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data</span>(p1) isa Q.A <span class="op">&amp;&amp;</span> <span class="fu">data</span>(p2) isa Q.C <span class="op">&amp;&amp;</span> <span class="fu">data</span>(p2).val <span class="op">&lt;</span> <span class="fl">0.0</span> <span class="op">&amp;&amp;</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">data</span>(p3) isa Q.A <span class="op">&amp;&amp;</span> <span class="fu">data</span>(p4) isa Q.C</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>Q9 <span class="op">=</span> <span class="fu">Query</span>(Q.B, condition <span class="op">=</span> Q9_fun)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>A9 <span class="op">=</span> <span class="fu">apply</span>(graph, Q9)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="17">
<pre><code>3-element Vector{Main.Queries.B}:
 Main.Queries.B(10)
 Main.Queries.B(6)
 Main.Queries.B(2)</code></pre>
</div>
</div>
</section>
<section id="nodes-containg-values-6-7-and-8" class="level2">
<h2 class="anchored" data-anchor-id="nodes-containg-values-6-7-and-8">Nodes containg values 6, 7 and 8</h2>
<p>We already came up with a condition to extract node 7. We can also modify the previous condition so that it only node 6. Node 8 can be identified by checking for the third parent node being of type <code>C</code> and being 5 nodes from the root of the graph.</p>
<p>As always, we can reusing previous conditions since they are just regular Julia functions:</p>
<div class="cell" data-execution_count="17">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Q10_fun</span>(n)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Q6_fun</span>(n, <span class="fl">3</span>) <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">true</span> <span class="co"># Check node 7</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Q9_fun</span>(n) <span class="op">&amp;&amp;</span> <span class="fu">hasAncestor</span>(n, condition <span class="op">=</span> isRoot)[<span class="fl">2</span>] <span class="op">==</span> <span class="fl">6</span> <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">true</span> <span class="co"># Check node 6</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hasAncestor</span>(n, condition <span class="op">=</span> isRoot)[<span class="fl">2</span>] <span class="op">==</span> <span class="fl">5</span> <span class="op">&amp;&amp;</span> <span class="fu">data</span>(<span class="fu">parent</span>(n, nsteps <span class="op">=</span> <span class="fl">3</span>)) isa Q.C <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">true</span> <span class="co"># Check node 8 (and not 4!)</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>Q10 <span class="op">=</span> <span class="fu">Query</span>(Q.B, condition <span class="op">=</span> Q10_fun)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>A10 <span class="op">=</span> <span class="fu">apply</span>(graph, Q10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="18">
<pre><code>3-element Vector{Main.Queries.B}:
 Main.Queries.B(7)
 Main.Queries.B(8)
 Main.Queries.B(6)</code></pre>
</div>
</div>
</section>
<section id="nodes-containig-values-3-7-11-and-12" class="level2">
<h2 class="anchored" data-anchor-id="nodes-containig-values-3-7-11-and-12">Nodes containig values 3, 7, 11 and 12</h2>
<p>We already have conditions to select nodes 3, 7 and 11 so we just need a new condition for node 12 (similar to the condition for 8).</p>
<div class="cell" data-execution_count="18">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Q11_fun</span>(n)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Q5_fun</span>(n) <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">true</span> <span class="co"># 3</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Q6_fun</span>(n, <span class="fl">3</span>) <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">true</span> <span class="co"># 7</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Q6_fun</span>(n, <span class="fl">4</span>) <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">true</span> <span class="co"># 11</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hasAncestor</span>(n, condition <span class="op">=</span> isRoot)[<span class="fl">2</span>] <span class="op">==</span> <span class="fl">5</span> <span class="op">&amp;&amp;</span> <span class="fu">data</span>(<span class="fu">parent</span>(n, nsteps <span class="op">=</span> <span class="fl">2</span>)) isa Q.C <span class="op">&amp;&amp;</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data</span>(<span class="fu">parent</span>(n, nsteps <span class="op">=</span> <span class="fl">4</span>)) isa Q.A <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">true</span> <span class="co"># 12</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>Q11 <span class="op">=</span> <span class="fu">Query</span>(Q.B, condition <span class="op">=</span> Q11_fun)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>A11 <span class="op">=</span> <span class="fu">apply</span>(graph, Q11)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="19">
<pre><code>4-element Vector{Main.Queries.B}:
 Main.Queries.B(7)
 Main.Queries.B(3)
 Main.Queries.B(12)
 Main.Queries.B(11)</code></pre>
</div>
</div>
</section>
<section id="nodes-containing-values-7-and-12" class="level2">
<h2 class="anchored" data-anchor-id="nodes-containing-values-7-and-12">Nodes containing values 7 and 12</h2>
<p>We just need to combine the conditions for the nodes 7 and 12</p>
<div class="cell" data-execution_count="19">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Q12_fun</span>(n)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Q6_fun</span>(n, <span class="fl">3</span>) <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">true</span> <span class="co"># 7</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hasAncestor</span>(n, condition <span class="op">=</span> isRoot)[<span class="fl">2</span>] <span class="op">==</span> <span class="fl">5</span> <span class="op">&amp;&amp;</span> <span class="fu">data</span>(<span class="fu">parent</span>(n, nsteps <span class="op">=</span> <span class="fl">2</span>)) isa Q.C <span class="op">&amp;&amp;</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data</span>(<span class="fu">parent</span>(n, nsteps <span class="op">=</span> <span class="fl">4</span>)) isa Q.A <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">true</span> <span class="co"># 12</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>Q12 <span class="op">=</span> <span class="fu">Query</span>(Q.B, condition <span class="op">=</span> Q12_fun)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>A12 <span class="op">=</span> <span class="fu">apply</span>(graph, Q12)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display" data-execution_count="20">
<pre><code>2-element Vector{Main.Queries.B}:
 Main.Queries.B(7)
 Main.Queries.B(12)</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>